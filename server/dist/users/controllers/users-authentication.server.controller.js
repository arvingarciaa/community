'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _passport=require('passport'),_passport2=_interopRequireDefault(_passport),_mongoose=require('mongoose'),_mongoose2=_interopRequireDefault(_mongoose),_crypto=require('crypto'),_crypto2=_interopRequireDefault(_crypto);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var User=_mongoose2.default.model('User'),userAuthControls={register:function register(a,b){var c=new User(a.body.userFormData);return c.setPassword(a.body.password),a.body.enteredKey&&process.env.ADMIN_REG_ACCESS_HASH!==_crypto2.default.pbkdf2Sync(a.body.enteredKey,process.env.ADMIN_REG_ACCESS_SALT,1e3,64).toString('hex')?void b.status(401).json({message:'Invalid Access Key!'}):void c.save(function(d){if(d)return d;var e=c.generateJwt();b.status(200).json({token:e})})},login:function login(a,b){_passport2.default.authenticate('local',function(c,d,e){if(c)return void b.status(404).json(c);if(d){var f=d.generateJwt();b.status(200).json({token:f})}else b.status(401).json(e)})(a,b)},allowAdminRegistration:function allowAdminRegistration(a,b){var c=_crypto2.default.pbkdf2Sync(a.body.enteredKey,process.env.ADMIN_REG_ACCESS_SALT,1e3,64).toString('hex');c===process.env.ADMIN_REG_ACCESS_HASH?b.status(200).json({allow:!0}):b.status(401).json({allow:!1})}};exports.default=userAuthControls;
//# sourceMappingURL=users-authentication.server.controller.js.map