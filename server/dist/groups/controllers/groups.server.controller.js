'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _groupsServer=require('../models/groups.server.model'),_groupsServer2=_interopRequireDefault(_groupsServer),_postsServer=require('../../posts/models/posts.server.model'),_postsServer2=_interopRequireDefault(_postsServer),_usersServer=require('../../users/models/users.server.model'),_usersServer2=_interopRequireDefault(_usersServer);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var groupControls={list:function list(a,b){_groupsServer2.default.find(function(c,d){return c?c:void b.send({groups:d})})},listByMyGroups:function listByMyGroups(a,b){var c=a.params.userID;_usersServer2.default.findOne({_id:c},function(d,e){if(d)return d;return null===e?b.status(404).send('User not found!'):void _groupsServer2.default.find({handle:{$in:e.groupsJoined}},function(f,g){return f?f:void b.send({groups:g})})})},listByDiscoverGroups:function listByDiscoverGroups(a,b){var c=a.params.userID;_usersServer2.default.findOne({_id:c},function(d,e){if(d)return d;return null===e?b.status(404).send('User not found!'):void _groupsServer2.default.find({handle:{$nin:e.groupsJoined}},function(f,g){return f?f:void b.send({groups:g})})})},listSome:function listSome(a,b){var c=a.params.handles.split(',');_groupsServer2.default.find({handle:{$in:c}},function(d,e){return d?d:void b.send({groups:e})})},listAdministeredGroups:function listAdministeredGroups(a,b){_groupsServer2.default.find({admin:a.params.userID},function(c,d){return c?c:void b.send({groups:d})})},listPendingGroups:function listPendingGroups(a,b){_groupsServer2.default.find({pendingMembers:a.params.userID},function(c,d){return c?c:void b.send({groups:d})})},listByGroupSearch:function listByGroupSearch(a,b){var c={};a.query.name&&(c.name={$regex:'^'+a.query.name+'$',$options:'i'}),a.query.description&&(c.description={$regex:'\\b'+a.query.description+'\\b',$options:'i'}),a.query.technology?_postsServer2.default.distinct('groupBelonged',{technologyHandles:{$regex:'^'+a.query.technology+'$',$options:'i'}},function(d,e){return d?d:void(c.handle={$in:e},_groupsServer2.default.find(c,function(f,g){return f?f:void b.send({groups:g})}))}):_groupsServer2.default.find(c,function(d,e){return d?d:void b.send({groups:e})})},listOne:function listOne(a,b){var c=a.params.handle;_groupsServer2.default.findOne({handle:c},function(d,e){if(d)return d;return null===e?b.status(404).send('Group not found!'):void b.send({group:e})})},post:function post(a,b){var c=new _groupsServer2.default(a.body);c.save(function(d){return d?d:void b.send('Group saved.')})},updateOne:function updateOne(a,b){var c=a.params.handle;_groupsServer2.default.findOneAndUpdate({handle:c},{$set:a.body},function(d){return d?d:void b.send('Group updated.')})},removeOne:function removeOne(a,b){var c=a.params.handle;_groupsServer2.default.findOneAndRemove({handle:c},function(d){return d?d:void b.send('Group deleted.')})},addAdmin:function addAdmin(a,b){var c=a.params.userID,d=a.params.handle;_groupsServer2.default.findOneAndUpdate({handle:d},{$addToSet:{admin:c}},function(e){return e?e:void b.send('Group added an admin.')})},removeAdmin:function removeAdmin(a,b){var c=a.params.userID,d=a.params.handle;_groupsServer2.default.findOneAndUpdate({handle:d},{$pull:{admin:c}},function(e){return e?e:void b.send('Group removed an admin.')})},addToPendingMembers:function addToPendingMembers(a,b){var c=a.params.userID,d=a.params.handle;_groupsServer2.default.findOneAndUpdate({handle:d},{$addToSet:{pendingMembers:c}},function(e){return e?e:void b.send('Group added a pending member.')})},removeFromPendingMembers:function removeFromPendingMembers(a,b){var c=a.params.userID,d=a.params.handle;_groupsServer2.default.findOneAndUpdate({handle:d},{$pull:{pendingMembers:c}},function(e){return e?e:void b.send('Group removed a pending member.')})}};exports.default=groupControls;
//# sourceMappingURL=groups.server.controller.js.map